<div 
  id="<%= dom_id link %>"
  data-controller="canvas"
  data-canvas-id-value="<%= link.id %>"
  data-canvas-x-value="<%= link.x_coordinate %>"
  data-canvas-y-value="<%= link.y_coordinate %>"
  data-canvas-update-url-value="<%= link_path(link) %>"
  data-action="mousedown->canvas#dragStart"
  class="bg-white shadow-lg rounded-lg border border-gray-200 w-64 absolute select-none cursor-grab hover:shadow-xl transition-shadow group z-0 hover:z-10"
>
  <!-- 画像エリア -->
  <div class="w-full h-32 bg-gray-100 rounded-t-lg overflow-hidden flex items-center justify-center pointer-events-none border-b border-gray-100 relative">
    <% if link.thumbnail.attached? %>
      <%= image_tag link.thumbnail.variant(resize_to_limit: [300, 200]), class: "object-contain w-full h-full", draggable: "false" %>
    <% else %>
      <span class="text-gray-400 text-sm">No Image</span>
    <% end %>
  </div>

  <!-- 情報エリア -->
  <div class="p-3">
    <h3 class="font-bold text-sm mb-1 truncate text-gray-800" title="<%= link.title %>">
      <%= link.title.presence || "No Title" %>
    </h3>
    <p class="text-xs text-gray-500 mb-2 truncate"><%= link.url %></p>

    <div class="flex justify-between items-center text-xs mt-2 border-t border-gray-50 pt-2">
      <a href="<%= link.url %>" target="_blank" class="text-blue-600 hover:underline font-bold flex items-center gap-1" onmousedown="event.stopPropagation()">
        Visit ↗
      </a>
      
      <div class="flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
        <%= link_to edit_link_path(link), class: "text-gray-400 hover:text-blue-600", onmousedown: "event.stopPropagation()", title: "編集" do %>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
        <% end %>
        <%= link_to link, 
            data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" }, 
            class: "text-gray-400 hover:text-red-500", 
            onmousedown: "event.stopPropagation()",
            title: "削除" do %>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
        <% end %>
      </div>
    </div>
  </div>
</div>